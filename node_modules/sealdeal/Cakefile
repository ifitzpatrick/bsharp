sealdeal = require './lib/sealdeal'
fs       = require 'fs'
path     = require 'path'

watch = (options) ->
  fs.readdir 'src', (err, filenames) ->
    for filename in filenames
      fs.watch path.join('src', filename), (event, filename) ->
        build options

    console.log 'Watching sealdeal src files...'

build = (options) ->
  sealdeal.compileJSDir 'src', 'lib'
  sealdeal.compileCoffeeFileTo 'src/sealdeal-executable.coffee', 'bin/sealdeal', (js) ->
    "#!/usr/bin/env node\n#{js}"

task "build", "compile coffeescript files to lib directory", build
task "watch", "watch src files and compile when changes occur", watch
